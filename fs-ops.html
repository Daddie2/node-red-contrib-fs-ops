<script type="text/javascript">
    RED.nodes.registerType('fs-ops-move',{
        category: 'storage',
        color: '#767432',
        defaults: {
            name: {value:""},
	    sourcePath: {value: "", required: true},
            sourcePathType: {value: "str"},
	    sourceFilename: {value: "", required: true},
            sourceFilenameType: {value: "msg"},
            destPath: {value: "", required: true},
            destPathType: {value: "str"},
            destFilename: {value: "", required: true},
            destFilenameType: {value: "msg"}
        },
        inputs:1,
        outputs:1,
        icon: "file.png",
        label: function() {
            return this.name||"File Move";
        },
        oneditprepare: function() {
            if (!this.sourcePathType) {
                this.sourcePathType = 'str';
            }
            $("#node-input-sourcePath").typedInput({
                default: 'str',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-sourcePathType")
            });

            if (!this.sourceFilenameType) {
                this.sourceFilenameType = 'msg';
            }
            $("#node-input-sourceFilename").typedInput({
                default: 'msg',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-sourceFilenameType")
            });

            if (!this.destPathType) {
                this.destPathType = 'str';
            }
            $("#node-input-destPath").typedInput({
                default: 'str',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-destPathType")
            });

            if (!this.destFilenameType) {
                this.destFilenameType = 'msg';
            }
            $("#node-input-destFilename").typedInput({
                default: 'msg',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-destFilenameType")
            });

        }
    });
</script>

<script type="text/x-red" data-template-name="fs-ops-move">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-sourcePath"><i class="fa fa-folder"></i> Source Path</label>
        <input type="text" id="node-input-sourcePath" placeholder="Path to move from" style="width:250px;">
        <input type="hidden" id="node-input-sourcePathType">
    </div>
    <div class="form-row">
        <label for="node-input-sourceFilename"><i class="fa fa-file"></i> Source Filename</label>
        <input type="text" id="node-input-sourceFilename" placeholder="Old filename" style="width:250px;">
        <input type="hidden" id="node-input-sourceFilenameType">
    </div>
    <div class="form-row">
        <label for="node-input-destPath"><i class="fa fa-folder"></i> Destination Path</label>
        <input type="text" id="node-input-destPath" placeholder="Path to move to" style="width:250px;">
        <input type="hidden" id="node-input-destPathType">
    </div>
    <div class="form-row">
        <label for="node-input-destFilename"><i class="fa fa-file"></i> Destination Filename</label>
        <input type="text" id="node-input-destFilename" placeholder="New filename" style="width:250px;">
        <input type="hidden" id="node-input-destFilenameType">
    </div>
</script>

<script type="text/x-red" data-help-name="fs-ops-move">
    <p>Moves a file from the source to the destination.</p>
    <p>Message is actioned and passed through unchanged if move/rename is successful.</p>
</script>


<script type="text/javascript">
    RED.nodes.registerType('fs-ops-delete',{
        category: 'storage',
        color: '#767432',
        defaults: {
            name: {value:""},
	    path: {value: "", required: true},
            pathType: {value: "str"},
	    filename: {value: "", required: true},
            filenameType: {value: "msg"}
        },
        inputs:1,
        outputs:1,
        icon: "file.png",
        label: function() {
            return this.name||"File Delete";
        },
        oneditprepare: function() {
            if (!this.pathType) {
                this.pathType = 'str';
            }
            $("#node-input-path").typedInput({
                default: 'str',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-pathType")
            });

            if (!this.filenameType) {
                this.filenameType = 'msg';
            }
            $("#node-input-filename").typedInput({
                default: 'msg',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-filenameType")
            });

        }
    });
</script>

<script type="text/x-red" data-template-name="fs-ops-delete">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-path"><i class="fa fa-folder"></i> Path</label>
        <input type="text" id="node-input-path" placeholder="Path of file to delete" style="width:250px;">
        <input type="hidden" id="node-input-pathType">
    </div>
    <div class="form-row">
        <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
        <input type="text" id="node-input-filename" placeholder="File to delete" style="width:250px;">
        <input type="hidden" id="node-input-filenameType">
    </div>
</script>

<script type="text/x-red" data-help-name="fs-ops-delete">
    <p>Deletes a file on host filesystem.</p>
    <p>Message is actioned and passed through unchanged if successful.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('fs-ops-access',{
        category: 'storage',
        color: '#767432',
        defaults: {
            name: {value:""},
	    path: {value: "", required: true},
            pathType: {value: "str"},
	    filename: {value: "", required: true},
            filenameType: {value: "msg"},
            read: {value: true},
            write: {value: true}
        },
        inputs:1,
        outputs:1,
        icon: "file.png",
        label: function() {
            return this.name||"File Access";
        },
        oneditprepare: function() {
            if (!this.pathType) {
                this.pathType = 'str';
            }
            $("#node-input-path").typedInput({
                default: 'str',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-pathType")
            });

            if (!this.filenameType) {
                this.filenameType = 'msg';
            }
            $("#node-input-filename").typedInput({
                default: 'msg',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-filenameType")
            });

        }
    });
</script>

<script type="text/x-red" data-template-name="fs-ops-access">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-path"><i class="fa fa-folder"></i> Path</label>
        <input type="text" id="node-input-path" placeholder="Path of file to delete" style="width:250px;">
        <input type="hidden" id="node-input-pathType">
    </div>
    <div class="form-row">
        <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
        <input type="text" id="node-input-filename" placeholder="File to delete" style="width:250px;">
        <input type="hidden" id="node-input-filenameType">
    </div>
    <div class="form-row">
        <label for="access"><i class="fa fa-lock"></i> Access</label>
        <input type="checkbox" checked value="true" id="node-input-read" style="display: inline-block; width: auto; vertical-align: top;"/>
        <label for="node-input-read" style="width: 30%;"> Read</label>
        <input type="checkbox" checked value="true" id="node-input-write" style="display: inline-block; width: auto; vertical-align: top;"/>
        <label for="node-input-write" style="width: 30%;"> Write</label>
    </div>
</script>

<script type="text/x-red" data-help-name="fs-ops-access">
    <p>Tests if a file is accessible on the host filesystem.</p>
    <p>Message is actioned and passed through unchanged if the file is accessible.
    An error is thrown otherwise that can be caught with a Catch node.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('fs-ops-size',{
        category: 'storage',
        color: '#767432',
        defaults: {
            name: {value:""},
	    path: {value: "", required: true},
            pathType: {value: "str"},
	    filename: {value: "", required: true},
            filenameType: {value: "msg"},
	    size: {value: "filesize", required: true},
            sizeType: {value: "msg"}
        },
        inputs:1,
        outputs:1,
        icon: "file.png",
        label: function() {
            return this.name||"File Size";
        },
        oneditprepare: function() {
            if (!this.pathType) {
                this.pathType = 'str';
            }
            $("#node-input-path").typedInput({
                default: 'str',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-pathType")
            });

            if (!this.filenameType) {
                this.filenameType = 'msg';
            }
            $("#node-input-filename").typedInput({
                default: 'msg',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-filenameType")
            });

            if (!this.sizeType) {
                this.sizeType = 'msg';
            }
            $("#node-input-size").typedInput({
                default: 'msg',
                types: ['msg','flow','global'],
                typeField: $("#node-input-sizeType")
            });

        }
    });
</script>

<script type="text/x-red" data-template-name="fs-ops-size">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-path"><i class="fa fa-folder"></i> Path</label>
        <input type="text" id="node-input-path" placeholder="Path" style="width:250px;">
        <input type="hidden" id="node-input-pathType">
    </div>
    <div class="form-row">
        <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
        <input type="text" id="node-input-filename" placeholder="Filename" style="width:250px;">
        <input type="hidden" id="node-input-filenameType">
    </div>
    <div class="form-row">
        <label for="node-input-size"><i class="fa fa-edit"></i> Size Property</label>
        <input type="text" id="node-input-size" placeholder="Property to record size" style="width:250px;">
        <input type="hidden" id="node-input-sizeType">
    </div>
</script>

<script type="text/x-red" data-help-name="fs-ops-dir">
    <p>Lists the files in a directory on host filesystem.</p>
    <p>Error is thrown and message dropped if directory cannot be accessed.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('fs-ops-dir',{
        category: 'storage',
        color: '#767432',
        defaults: {
            name: {value:""},
	    path: {value: "", required: true},
            pathType: {value: "str"},
	    filter: {value: "*"},
            filterType: {value: "str"},
	    dir: {value: "files", required: true},
            dirType: {value: "msg"}
        },
        inputs:1,
        outputs:1,
        icon: "db.png",
        label: function() {
            return this.name||"Directory";
        },
        oneditprepare: function() {
            if (!this.pathType) {
                this.pathType = 'str';
            }
            $("#node-input-path").typedInput({
                default: 'str',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-pathType")
            });

            if (!this.filterType) {
                this.filterType = 'msg';
            }
            $("#node-input-filter").typedInput({
                default: 'msg',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-filterType")
            });

            if (!this.dirType) {
                this.dirType = 'msg';
            }
            $("#node-input-dir").typedInput({
                default: 'msg',
                types: ['msg','flow','global'],
                typeField: $("#node-input-dirType")
            });

        }
    });
</script>

<script type="text/x-red" data-template-name="fs-ops-dir">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-path"><i class="fa fa-folder"></i> Path</label>
        <input type="text" id="node-input-path" placeholder="Path" style="width:250px;">
        <input type="hidden" id="node-input-pathType">
    </div>
    <div class="form-row">
        <label for="node-input-filter"><i class="fa fa-filter"></i> Filter</label>
        <input type="text" id="node-input-filter" placeholder="Filename filter" style="width:250px;">
        <input type="hidden" id="node-input-filterType">
    </div>
    <div class="form-row">
        <label for="node-input-dir"><i class="fa fa-edit"></i> Directory Property</label>
        <input type="text" id="node-input-dir" placeholder="Property to record directory files" style="width:250px;">
        <input type="hidden" id="node-input-dirType">
    </div>
</script>

<script type="text/x-red" data-help-name="fs-ops-dir">
    <p>Determines the size of a file on host filesystem.</p>
    <p>File names are returned as a array in the specified property.Error is thrown and message
    dropped if size cannot be determined.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('fs-ops-mkdir',{
        category: 'storage',
        color: '#767432',
        defaults: {
            name: {value:""},
	    path: {value: "", required: true},
            pathType: {value: "str"},
	    dirname: {value: "", required: true},
            dirnameType: {value: "msg"},
            mode: {value: "777", required: true, validate:RED.validators.regex(/[0-7][0-7][0-7]/)}
        },
        inputs:1,
        outputs:1,
        icon: "file.png",
        label: function() {
            return this.name||"Make Directory";
        },
        oneditprepare: function() {
            if (!this.pathType) {
                this.pathType = 'str';
            }
            $("#node-input-path").typedInput({
                default: 'str',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-pathType")
            });

            if (!this.dirnameType) {
                this.dirnameType = 'msg';
            }
            $("#node-input-dirname").typedInput({
                default: 'msg',
                types: ['str','msg','flow','global'],
                typeField: $("#node-input-dirnameType")
            });

        }
    });
</script>

<script type="text/x-red" data-template-name="fs-ops-mkdir">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-path"><i class="fa fa-folder"></i> Path</label>
        <input type="text" id="node-input-path" placeholder="Path of file to delete" style="width:250px;">
        <input type="hidden" id="node-input-pathType">
    </div>
    <div class="form-row">
        <label for="node-input-dirname"><i class="fa fa-folder"></i> Directory</label>
        <input type="text" id="node-input-dirname" placeholder="New directory name" style="width:250px;">
        <input type="hidden" id="node-input-dirnameType">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="icon-tag"></i> Access Mode</label>
        <input type="text" id="node-input-mode" placeholder="Octal">
    </div>
</script>

<script type="text/x-red" data-help-name="fs-ops-mkdir">
    <p>Deletes a file on host filesystem.</p>
    <p>Message is actioned and passed through unchanged if successful.</p>
</script>
